<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>capitovo — Abo verwalten</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../style.css">
</head>
<body class="bg-white text-gray-900">
    <header>
        <div class="header-content">
            <div class="logo">
                <a href="./abonenten.html">
                    <img src="../assets/capitovo_logo_weiß.png" alt="capitovo Logo" class="header-logo">
                </a>
            </div>
            <button class="menu-toggle" id="menu-toggle" aria-controls="sidebar" aria-expanded="false" aria-label="Menü öffnen">☰</button>
        </div>
    </header>

    <main class="max-w-[1200px] mx-auto px-6 py-12">
        <div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden">
            <div class="p-6 border-b border-gray-100">
                <h1 class="text-2xl font-bold">Abo verwalten</h1>
                <p class="text-sm text-gray-500 mt-1">Passen Sie Ihr Abonnement an — Änderungen werden sofort übernommen.</p>
            </div>

            <div class="p-6">
                <div class="prose max-w-none">
                    <h2 class="text-lg font-semibold">Abo verwalten</h2>
                    <p class="text-sm text-gray-700">Wählen Sie aus den verfügbaren Abonnement-Modellen. Änderungen werden in Ihrem Browser gespeichert und sind sofort auf allen Seiten sichtbar.</p>

                    <div class="mt-6 space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-stretch mb-6">
                            <!-- Free -->
                            <div id="card-free" class="plan-card bg-white rounded-xl shadow-xl border-4 border-transparent p-8 flex flex-col justify-between hover:shadow-2xl transition-all duration-300 cursor-pointer h-full" onclick="selectPlan('free')">
                                <div>
                                    <h3 class="text-2xl font-bold text-gray-900 mb-4">Free</h3>
                                    <div class="text-4xl font-extrabold text-gray-900 mb-4">€ 0,- <span class="text-xl font-normal text-gray-500">/ Monat</span></div>

                                    <div class="plan-details w-full">
                                        <ul class="text-left space-y-3 mb-10 text-gray-700 w-full">
                                            <li class="flex items-start">
                                                <svg class="w-5 h-5 text-green-500 mr-2 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                                Wöchentliche Markt-Bulletins
                                            </li>
                                            <li class="flex items-start">
                                                <svg class="w-5 h-5 text-green-500 mr-2 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                                2 exklusive Aktienanalysen / Monat
                                            </li>
                                            <li class="flex items-start">
                                                <svg class="w-5 h-5 text-red-500 mr-2 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                                Zugang zum Performance-Dashboard
                                            </li>
                                            <li class="flex items-start">
                                                <svg class="w-5 h-5 text-red-500 mr-2 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                                                Exklusive Webinare & Q&A
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <button class="select-plan-btn w-full block py-3 px-8 border border-gray-300 rounded-lg shadow-sm text-base font-medium text-gray-900 bg-white hover:bg-gray-100 transition duration-150 mt-4">Wählen</button>
                            </div>

                            <!-- Premium -->
                            <div id="card-premium" class="plan-card bg-primary-blue rounded-xl shadow-2xl border-4 border-transparent p-8 flex flex-col justify-between transform scale-105 z-10 cursor-pointer h-full" onclick="selectPlan('premium')">
                                <div class="relative">
                                    <span id="premium-badge" class="absolute -top-10 left-1/2 transform -translate-x-1/2 bg-yellow-400 text-gray-900 text-xs font-bold uppercase py-1 px-3 rounded-full shadow-md">Empfohlen</span>
                                    <h3 class="text-2xl font-bold text-white mb-4">Premium</h3>
                                    <div class="text-4xl font-extrabold text-white mb-4">€ 14,99 <span class="text-xl font-normal text-blue-200">/ Monat</span></div>

                                    <div class="plan-details w-full">
                                        <ul class="text-left space-y-3 mb-10 text-white w-full">
                                            <li class="flex items-start">
                                                <svg class="w-5 h-5 text-yellow-400 mr-2 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                                Alle Free-Funktionen
                                            </li>
                                            <li class="flex items-start">
                                                <svg class="w-5 h-5 text-yellow-400 mr-2 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                                <strong>Alle</strong> exklusiven Aktienanalysen (4+ / Monat)
                                            </li>
                                            <li class="flex items-start">
                                                <svg class="w-5 h-5 text-yellow-400 mr-2 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                                Zugang zum Performance-Dashboard
                                            </li>
                                            <li class="flex items-start">
                                                <svg class="w-5 h-5 text-yellow-400 mr-2 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                                Exklusive Webinare & Q&A
                                            </li>
                                            <li class="flex items-start">
                                                <svg class="w-5 h-5 text-yellow-400 mr-2 mt-1 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                                                14-tägige Geld-zurück-Garantie
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <button class="select-plan-btn w-full block py-3 px-8 border border-white rounded-lg shadow-lg text-base font-medium text-primary-blue bg-white hover:bg-blue-100 transition duration-150 mt-4">Wählen</button>
                            </div>

                            <!-- (No Lifetime) -->
                        </div>

                        <div class="border-t border-gray-200 pt-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-gray-600">Zwischensumme</span>
                                <span id="summary-subtotal" class="font-medium">€ 0,-</span>
                            </div>

                            <div class="flex justify-between items-center text-xl font-extrabold text-gray-900 mt-4">
                                <span>Gesamt</span>
                                <span id="summary-total">€ 0,-</span>
                            </div>
                            <div class="mt-2 text-xs text-gray-500 text-right">inkl. MwSt.</div>
                        </div>

                        <div class="flex items-center mt-4">
                            <button id="save-plan" class="px-4 py-2 bg-primary-blue text-white rounded-md back-btn-glow">Änderungen speichern</button>
                            <a href="./konto.html" class="ml-3 px-4 py-2 border border-gray-300 rounded-md text-sm hover:bg-gray-50">Abbrechen</a>
                        </div>

                        <!-- Kündigen Abschnitt -->
                        <div class="mt-8 border-t pt-6">
                            <h3 class="text-lg font-semibold">Abo kündigen</h3>
                            <p class="text-sm text-gray-600 mt-2">Wenn Sie Ihr Abo kündigen möchten, klicken Sie auf "Kündigung bestätigen". Ihr Zugang bleibt bis zum Ende des bereits bezahlten Zeitraums aktiv.</p>
                            <div class="mt-4">
                                <button id="confirm-cancel" class="px-4 py-2 bg-red-600 text-white rounded-md">Kündigung bestätigen</button>
                                <button id="cancel-abort" class="ml-3 px-4 py-2 border border-gray-300 rounded-md">Abbrechen</button>
                            </div>
                        </div>
                    </div>

                    <p class="text-xs text-gray-500 mt-6">Hinweis: Diese Demo speichert die Auswahl im Browser (`localStorage`). Andere Seiten lesen dieselben Daten und zeigen die aktualisierten Abo-Informationen an.</p>
                </div>
            </div>
        </div>
    </main>

    <footer class="site-footer py-8">
        <div class="footer-inner max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <p class="text-sm text-gray-600">&copy; 2024 capitovo. Wachstum durch Wissen.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sessionKey = 'capitovo_session';
            const stored = JSON.parse(localStorage.getItem(sessionKey) || 'null') || {};
            let currentPlan = stored.subscription || null;

            const plans = {
                free: { price: '€ 0,-' },
                premium: { price: '€ 14,99' }
            };

            const totalEl = document.getElementById('summary-total');
            const subtotalEl = document.getElementById('summary-subtotal');

            const premiumBadge = document.getElementById('premium-badge');

            function updateUIForSelection(planKey){
                ['free','premium'].forEach(key => {
                    const card = document.getElementById(`card-${key}`);
                    const btn = card.querySelector('.select-plan-btn');

                    if(key === planKey){
                        card.classList.remove('border-transparent','opacity-60','scale-95');
                        card.classList.add('scale-105','z-20','shadow-2xl');

                        if(key === 'premium') card.classList.add('border-yellow-400');
                        else card.classList.add('border-blue-500');

                        btn.textContent = 'Ausgewählt';
                        btn.classList.remove('bg-white','text-gray-900','text-primary-blue','border-gray-300','border-white','hover:bg-gray-100','hover:bg-blue-100');
                        btn.classList.add('bg-gray-900','text-white','border-transparent','cursor-default','shadow-inner');
                    } else {
                        card.classList.add('border-transparent','opacity-90','scale-95');
                        card.classList.remove('border-blue-500','border-yellow-400','scale-105','z-10','z-20','shadow-2xl');

                        btn.textContent = 'Wählen';
                        btn.classList.remove('bg-gray-900','text-white','border-transparent','cursor-default','shadow-inner');

                        if(key === 'premium') btn.classList.add('bg-white','text-primary-blue','border-white','hover:bg-blue-100');
                        else btn.classList.add('bg-white','text-gray-900','border-gray-300','hover:bg-gray-100');
                    }
                });

                // update totals
                const p = plans[planKey];
                if(p){
                    subtotalEl.textContent = p.price;
                    totalEl.textContent = p.price + ' / Monat';
                } else {
                    subtotalEl.textContent = '€ 0,-';
                    totalEl.textContent = '€ 0,-';
                }
            }

            window.selectPlan = function(planKey){
                currentPlan = planKey;
                updateUIForSelection(planKey);
                // update URL param (optional)
                try{
                    const url = new URL(window.location);
                    url.searchParams.set('plan', planKey);
                    window.history.replaceState({}, '', url);
                }catch(e){}
                // Update premium badge when selection changes
                if(premiumBadge){
                    if(currentPlan === 'premium'){
                        premiumBadge.textContent = 'Ihr Abo';
                        premiumBadge.classList.remove('bg-yellow-400','text-gray-900');
                        premiumBadge.classList.add('bg-green-400','text-white');
                    } else {
                        premiumBadge.textContent = 'Empfohlen';
                        premiumBadge.classList.remove('bg-green-400','text-white');
                        premiumBadge.classList.add('bg-yellow-400','text-gray-900');
                    }
                }
            };

            // initialize UI from stored session
            if(currentPlan && plans[currentPlan]){
                updateUIForSelection(currentPlan);
            }
            // If stored session indicates premium (or test account), mark badge as current
            if(premiumBadge){
                if(stored.subscription === 'premium'){
                    premiumBadge.textContent = 'Ihr Abo';
                    premiumBadge.classList.remove('bg-yellow-400','text-gray-900');
                    premiumBadge.classList.add('bg-green-400','text-white');
                } else {
                    premiumBadge.textContent = 'Empfohlen';
                    premiumBadge.classList.remove('bg-green-400','text-white');
                    premiumBadge.classList.add('bg-yellow-400','text-gray-900');
                }
            }

            document.getElementById('save-plan').addEventListener('click', function(){
                const s = stored || {};
                s.subscription = currentPlan || null;
                if(s.subscription === 'premium') s.nextPayment = '01.01.2026';
                else s.nextPayment = '-';
                localStorage.setItem(sessionKey, JSON.stringify(s));
                alert('Ihr Abonnement wurde aktualisiert. Änderungen sind jetzt aktiv.');
                window.location.href = './konto.html';
            });

            document.getElementById('confirm-cancel').addEventListener('click', function(){
                const s = stored || {};
                s.subscription = null;
                s.canceled = true;
                s.nextPayment = '-';
                localStorage.setItem(sessionKey, JSON.stringify(s));
                alert('Ihr Abonnement wurde gekündigt.');
                window.location.href = './konto.html';
            });

            document.getElementById('cancel-abort').addEventListener('click', function(){
                // reset UI to stored value
                currentPlan = stored.subscription || null;
                if(currentPlan) updateUIForSelection(currentPlan);
                else {
                    // clear visual selection
                        ['free','premium'].forEach(k=>{
                            const c = document.getElementById(`card-${k}`);
                            const b = c.querySelector('.select-plan-btn');
                            c.classList.remove('scale-105','z-20','shadow-2xl');
                            c.classList.remove('border-blue-500','border-yellow-400');
                            b.textContent = 'Wählen';
                        });
                    subtotalEl.textContent = '€ 0,-';
                    totalEl.textContent = '€ 0,-';
                    if(premiumBadge){
                        premiumBadge.textContent = 'Empfohlen';
                        premiumBadge.classList.remove('bg-green-400','text-white');
                        premiumBadge.classList.add('bg-yellow-400','text-gray-900');
                    }
                }
            });
        });
    </script>
</body>
</html>
