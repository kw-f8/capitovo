<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>capitovo ‚Äî API Test Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Page specific */
        .test-container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 20px;
        }
        .feature-box {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .feature-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }
        .stock-card {
            background: #f8fafc;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .stock-info {
            flex: 1;
        }
        .stock-symbol {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1e293b;
        }
        .stock-name {
            font-size: 0.875rem;
            color: #64748b;
        }
        .stock-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0f172a;
        }
        .stock-change {
            font-size: 0.875rem;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .positive {
            color: #16a34a;
            background: #f0fdf4;
        }
        .negative {
            color: #dc2626;
            background: #fef2f2;
        }
        .loading {
            color: #64748b;
            font-style: italic;
        }
        .error {
            color: #dc2626;
            font-size: 0.875rem;
        }
        .sparkline-container {
            width: 200px;
            height: 60px;
        }
        .last-update {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 4px;
        }
        .watchlist-add {
            background: #0ea5e9;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .watchlist-add:hover {
            background: #0284c7;
        }
        .mini-chart {
            margin-top: 16px;
            padding: 16px;
            background: #f1f5f9;
            border-radius: 8px;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">

<header>
    <div class="header-content">
        <div class="logo">
            <a href="index.html">
                <img src="caitavo_logo_wei√ü.png" alt="capitovo Logo" class="header-logo">
            </a>
        </div>
    </div>
</header>

<main class="test-container">
    <div style="margin-bottom: 32px;">
        <h1 style="font-size: 2rem; font-weight: 800; color: #0f172a; margin-bottom: 8px;">üìä Investor Relations Dashboard</h1>
        <p style="color: #64748b;">Insider-Trading, Institutionelle Holdings und Earnings-Kalender f√ºr unsere analysierten Unternehmen.</p>
    </div>

    <!-- Feature 1: Earnings Calendar & Events -->
    <div class="feature-box">
        <h2 class="feature-title">üìÖ Earnings-Kalender & Wichtige Termine</h2>
        <p style="color: #64748b; margin-bottom: 20px; font-size: 0.875rem;">N√§chste Earnings-Termine, Ex-Dividenden-Daten und wichtige Investoren-Events.</p>
        
        <div id="earnings-calendar">
            <!-- Tesla -->
            <div class="stock-card" style="border-left: 4px solid #0ea5e9;">
                <div class="stock-info" style="flex: 2;">
                    <div class="stock-symbol">TSLA</div>
                    <div class="stock-name">Tesla Inc.</div>
                </div>
                <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">N√§chster Earnings</div>
                    <div style="font-size: 1rem; font-weight: 700; color: #0f172a;">23. Januar 2026</div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">Q4 2025 Ergebnisse</div>
                </div>
                <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Ex-Dividenden-Datum</div>
                    <div style="font-size: 1rem; font-weight: 700; color: #94a3b8;">N/A</div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">Keine Dividende</div>
                </div>
            </div>

            <!-- Ferrari -->
            <div class="stock-card" style="border-left: 4px solid #dc2626;">
                <div class="stock-info" style="flex: 2;">
                    <div class="stock-symbol">RACE</div>
                    <div class="stock-name">Ferrari N.V.</div>
                </div>
                <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">N√§chster Earnings</div>
                    <div style="font-size: 1rem; font-weight: 700; color: #0f172a;">5. Februar 2026</div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">FY 2025 Ergebnisse</div>
                </div>
                <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Ex-Dividenden-Datum</div>
                    <div style="font-size: 1rem; font-weight: 700; color: #0f172a;">12. Dezember 2025</div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">‚Ç¨1,45 / Aktie</div>
                </div>
            </div>

            <!-- Johnson & Johnson -->
            <div class="stock-card" style="border-left: 4px solid #16a34a;">
                <div class="stock-info" style="flex: 2;">
                    <div class="stock-symbol">JNJ</div>
                    <div class="stock-name">Johnson & Johnson</div>
                </div>
                <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">N√§chster Earnings</div>
                    <div style="font-size: 1rem; font-weight: 700; color: #0f172a;">21. Januar 2026</div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">Q4 2025 Ergebnisse</div>
                </div>
                <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Ex-Dividenden-Datum</div>
                    <div style="font-size: 1rem; font-weight: 700; color: #0f172a;">25. Februar 2026</div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">$1,30 / Aktie (63. Jahr ‚Üë)</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Feature 2: Insider Trading & Institutional Holdings -->
    <div class="feature-box">
        <h2 class="feature-title">üè¶ Insider-Trading & Institutionelle Holdings</h2>
        <p style="color: #64748b; margin-bottom: 20px; font-size: 0.875rem;">Wer kauft oder verkauft? Aktivit√§ten von Insidern und gro√üen institutionellen Investoren.</p>
        
        <!-- Stock Selector -->
        <div style="margin-bottom: 24px; display: flex; gap: 12px; flex-wrap: wrap;">
            <button onclick="showStock('TSLA')" id="btn-tsla" class="stock-selector-btn active" style="padding: 8px 20px; background: #0ea5e9; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.875rem; transition: all 0.2s;">
                TSLA
            </button>
            <button onclick="showStock('RACE')" id="btn-race" class="stock-selector-btn" style="padding: 8px 20px; background: #e2e8f0; color: #64748b; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.875rem; transition: all 0.2s;">
                RACE
            </button>
            <button onclick="showStock('JNJ')" id="btn-jnj" class="stock-selector-btn" style="padding: 8px 20px; background: #e2e8f0; color: #64748b; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.875rem; transition: all 0.2s;">
                JNJ
            </button>
        </div>

        <!-- TSLA Content -->
        <div id="stock-content-tsla" class="stock-content">
            <h3 style="font-size: 1.25rem; font-weight: 700; color: #0f172a; margin-bottom: 16px; display: flex; align-items: center;">
                <span style="display: inline-block; width: 10px; height: 10px; background: #0ea5e9; border-radius: 50%; margin-right: 10px;"></span>
                Tesla Inc. (TSLA)
            </h3>
            
            <!-- Summary Cards -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 20px;">
                <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 14px; border-radius: 8px; border-left: 4px solid #0284c7;">
                    <div style="font-size: 0.7rem; font-weight: 600; color: #0c4a6e; text-transform: uppercase; margin-bottom: 4px;">Insider-K√§ufe (90T)</div>
                    <div id="tsla-buys-summary" style="font-size: 1.1rem; font-weight: 700; color: #16a34a;">-</div>
                </div>
                <div style="background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); padding: 14px; border-radius: 8px; border-left: 4px solid #dc2626;">
                    <div style="font-size: 0.7rem; font-weight: 600; color: #991b1b; text-transform: uppercase; margin-bottom: 4px;">Insider-Verk√§ufe (90T)</div>
                    <div id="tsla-sells-summary" style="font-size: 1.1rem; font-weight: 700; color: #dc2626;">-</div>
                </div>
                <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 14px; border-radius: 8px; border-left: 4px solid #16a34a;">
                    <div style="font-size: 0.7rem; font-weight: 600; color: #166534; text-transform: uppercase; margin-bottom: 4px;">Institutionelle Anleger</div>
                    <div id="tsla-holders-count" style="font-size: 1.1rem; font-weight: 700; color: #0f172a;">-</div>
                </div>
            </div>

            <!-- Insider Trades Table -->
            <div style="background: white; border-radius: 8px; border: 1px solid #e2e8f0; overflow: hidden; margin-bottom: 20px;">
                <div style="background: #f8fafc; padding: 12px 16px; border-bottom: 1px solid #e2e8f0;">
                    <h4 style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin: 0;">üìä Insider-Transaktionen (letzte 20)</h4>
                </div>
                <div id="insider-tsla" style="max-height: 400px; overflow-y: auto;">
                    <p class="loading" style="padding: 16px;">Lade Daten...</p>
                </div>
            </div>

            <!-- Institutional Holdings -->
            <div style="background: white; border-radius: 8px; border: 1px solid #e2e8f0; overflow: hidden;">
                <div style="background: #f8fafc; padding: 12px 16px; border-bottom: 1px solid #e2e8f0;">
                    <h4 style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin: 0;">üèõÔ∏è Top Institutionelle Anleger</h4>
                </div>
                <div id="holdings-tsla" style="padding: 16px;">
                    <p class="loading">L√§dt...</p>
                </div>
            </div>
        </div>

        <!-- RACE Content -->
        <div id="stock-content-race" class="stock-content" style="display: none;">
            <h3 style="font-size: 1.25rem; font-weight: 700; color: #0f172a; margin-bottom: 16px; display: flex; align-items: center;">
                <span style="display: inline-block; width: 10px; height: 10px; background: #dc2626; border-radius: 50%; margin-right: 10px;"></span>
                Ferrari N.V. (RACE)
            </h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 20px;">
                <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 14px; border-radius: 8px; border-left: 4px solid #0284c7;">
                    <div style="font-size: 0.7rem; font-weight: 600; color: #0c4a6e; text-transform: uppercase; margin-bottom: 4px;">Insider-K√§ufe (90T)</div>
                    <div id="race-buys-summary" style="font-size: 1.1rem; font-weight: 700; color: #16a34a;">-</div>
                </div>
                <div style="background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); padding: 14px; border-radius: 8px; border-left: 4px solid #dc2626;">
                    <div style="font-size: 0.7rem; font-weight: 600; color: #991b1b; text-transform: uppercase; margin-bottom: 4px;">Insider-Verk√§ufe (90T)</div>
                    <div id="race-sells-summary" style="font-size: 1.1rem; font-weight: 700; color: #dc2626;">-</div>
                </div>
                <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 14px; border-radius: 8px; border-left: 4px solid #16a34a;">
                    <div style="font-size: 0.7rem; font-weight: 600; color: #166534; text-transform: uppercase; margin-bottom: 4px;">Institutionelle Anleger</div>
                    <div id="race-holders-count" style="font-size: 1.1rem; font-weight: 700; color: #0f172a;">-</div>
                </div>
            </div>

            <div style="background: white; border-radius: 8px; border: 1px solid #e2e8f0; overflow: hidden; margin-bottom: 20px;">
                <div style="background: #f8fafc; padding: 12px 16px; border-bottom: 1px solid #e2e8f0;">
                    <h4 style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin: 0;">üìä Insider-Transaktionen (letzte 20)</h4>
                </div>
                <div id="insider-race" style="max-height: 400px; overflow-y: auto;">
                    <p class="loading" style="padding: 16px;">Lade Daten...</p>
                </div>
            </div>

            <div style="background: white; border-radius: 8px; border: 1px solid #e2e8f0; overflow: hidden;">
                <div style="background: #f8fafc; padding: 12px 16px; border-bottom: 1px solid #e2e8f0;">
                    <h4 style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin: 0;">üèõÔ∏è Top Institutionelle Anleger</h4>
                </div>
                <div id="holdings-race" style="padding: 16px;">
                    <p class="loading">L√§dt...</p>
                </div>
            </div>
        </div>

        <!-- JNJ Content -->
        <div id="stock-content-jnj" class="stock-content" style="display: none;">
            <h3 style="font-size: 1.25rem; font-weight: 700; color: #0f172a; margin-bottom: 16px; display: flex; align-items: center;">
                <span style="display: inline-block; width: 10px; height: 10px; background: #16a34a; border-radius: 50%; margin-right: 10px;"></span>
                Johnson & Johnson (JNJ)
            </h3>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 20px;">
                <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); padding: 14px; border-radius: 8px; border-left: 4px solid #0284c7;">
                    <div style="font-size: 0.7rem; font-weight: 600; color: #0c4a6e; text-transform: uppercase; margin-bottom: 4px;">Insider-K√§ufe (90T)</div>
                    <div id="jnj-buys-summary" style="font-size: 1.1rem; font-weight: 700; color: #16a34a;">-</div>
                </div>
                <div style="background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%); padding: 14px; border-radius: 8px; border-left: 4px solid #dc2626;">
                    <div style="font-size: 0.7rem; font-weight: 600; color: #991b1b; text-transform: uppercase; margin-bottom: 4px;">Insider-Verk√§ufe (90T)</div>
                    <div id="jnj-sells-summary" style="font-size: 1.1rem; font-weight: 700; color: #dc2626;">-</div>
                </div>
                <div style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); padding: 14px; border-radius: 8px; border-left: 4px solid #16a34a;">
                    <div style="font-size: 0.7rem; font-weight: 600; color: #166534; text-transform: uppercase; margin-bottom: 4px;">Institutionelle Anleger</div>
                    <div id="jnj-holders-count" style="font-size: 1.1rem; font-weight: 700; color: #0f172a;">-</div>
                </div>
            </div>

            <div style="background: white; border-radius: 8px; border: 1px solid #e2e8f0; overflow: hidden; margin-bottom: 20px;">
                <div style="background: #f8fafc; padding: 12px 16px; border-bottom: 1px solid #e2e8f0;">
                    <h4 style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin: 0;">üìä Insider-Transaktionen (letzte 20)</h4>
                </div>
                <div id="insider-jnj" style="max-height: 400px; overflow-y: auto;">
                    <p class="loading" style="padding: 16px;">Lade Daten...</p>
                </div>
            </div>

            <div style="background: white; border-radius: 8px; border: 1px solid #e2e8f0; overflow: hidden;">
                <div style="background: #f8fafc; padding: 12px 16px; border-bottom: 1px solid #e2e8f0;">
                    <h4 style="font-size: 0.875rem; font-weight: 700; color: #0f172a; margin: 0;">üèõÔ∏è Top Institutionelle Anleger</h4>
                </div>
                <div id="holdings-jnj" style="padding: 16px;">
                    <p class="loading">L√§dt...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Info Box -->
    <div class="feature-box" style="background: #dbeafe; border-left: 4px solid #0284c7;">
        <h2 class="feature-title" style="color: #0c4a6e;">‚ÑπÔ∏è Datenaktualisierung</h2>
        <ul style="color: #1e3a8a; font-size: 0.875rem; line-height: 1.6;">
            <li><strong>Earnings-Termine:</strong> Aktualisierung quartalsweise nach offiziellen Unternehmensmitteilungen</li>
            <li><strong>Dividenden-Daten:</strong> Aktualisierung nach Dividendenank√ºndigungen (quartalsweise)</li>
            <li><strong>Insider-Trading:</strong> Basierend auf SEC Form 4 Filings (w√∂chentliche Updates)</li>
            <li><strong>Institutionelle Holdings:</strong> Basierend auf SEC 13F Filings (quartalsweise)</li>
            <li><strong>Letzte Aktualisierung:</strong> 30. November 2025</li>
        </ul>
    </div>

</main>

<footer class="site-footer border-t py-6 mt-12">
    <div class="footer-inner max-w-6xl mx-auto px-6 text-sm text-gray-500 flex items-center justify-between">
        <div>&copy; 2025 capitovo ‚Äî Test-Dashboard</div>
    </div>
</footer>

<script>
    // Financial Modeling Prep API Configuration
    const FMP_API_KEY = 'OQ6IIDD26Cnm3fPtXiQw8O05ZAaBPFRI';
    const FMP_BASE_URL = 'https://financialmodelingprep.com/api/v3';
    const FMP_BASE_URL_V4 = 'https://financialmodelingprep.com/api/v4';

    const STOCKS = ['TSLA', 'RACE', 'JNJ'];

    // Utility: Format large numbers
    function formatNumber(num) {
        if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
        if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
        if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
        return num.toFixed(0);
    }

    // Utility: Format date
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('de-DE', { day: '2-digit', month: 'short', year: 'numeric' });
    }

    // Load Earnings Calendar
    async function loadEarningsCalendar() {
        const container = document.getElementById('earnings-calendar');
        container.innerHTML = '<p class="loading">Lade Earnings-Kalender...</p>';

        try {
            const promises = STOCKS.map(async (symbol) => {
                const url = `${FMP_BASE_URL}/historical/earning_calendar/${symbol}?apikey=${FMP_API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                // Get next earnings (future date)
                const now = new Date();
                const nextEarnings = data.find(e => new Date(e.date) > now) || data[0];
                
                return { symbol, earnings: nextEarnings };
            });

            const results = await Promise.all(promises);
            
            let html = '';
            const colors = { TSLA: '#0ea5e9', RACE: '#dc2626', JNJ: '#16a34a' };
            const names = { TSLA: 'Tesla Inc.', RACE: 'Ferrari N.V.', JNJ: 'Johnson & Johnson' };

            results.forEach(({ symbol, earnings }) => {
                const date = earnings ? formatDate(earnings.date) : 'TBA';
                const eps = earnings?.epsEstimated ? `$${earnings.epsEstimated.toFixed(2)} EPS (est.)` : 'N/A';
                
                html += `
                    <div class="stock-card" style="border-left: 4px solid ${colors[symbol]};">
                        <div class="stock-info" style="flex: 2;">
                            <div class="stock-symbol">${symbol}</div>
                            <div class="stock-name">${names[symbol]}</div>
                        </div>
                        <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                            <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">N√§chster Earnings</div>
                            <div style="font-size: 1rem; font-weight: 700; color: #0f172a;">${date}</div>
                            <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">${eps}</div>
                        </div>
                        <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                            <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Revenue (est.)</div>
                            <div style="font-size: 1rem; font-weight: 700; color: #0f172a;">${earnings?.revenueEstimated ? '$' + formatNumber(earnings.revenueEstimated) : 'N/A'}</div>
                            <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">Analystensch√§tzung</div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        } catch (error) {
            console.error('Fehler beim Laden des Earnings-Kalenders:', error);
            container.innerHTML = '<p style="color: #ef4444;">Fehler beim Laden der Daten. Bitte sp√§ter erneut versuchen.</p>';
        }
    }

    // Load Insider Trading Data
    async function loadInsiderTrading() {
        try {
            const promises = STOCKS.map(async (symbol) => {
                const url = `${FMP_BASE_URL_V4}/insider-trading?symbol=${symbol}&limit=50&apikey=${FMP_API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                return { symbol, trades: data.slice(0, 20) }; // Top 20 trades
            });

            const results = await Promise.all(promises);

            results.forEach(({ symbol, trades }) => {
                const containerId = `insider-${symbol.toLowerCase()}`;
                const container = document.getElementById(containerId);
                
                if (!trades || trades.length === 0) {
                    container.innerHTML = '<p style="color: #94a3b8; font-size: 0.875rem; padding: 16px;">Keine aktuellen Insider-Trades verf√ºgbar.</p>';
                    return;
                }

                // Calculate summary for 90 days
                let totalBuys = 0, totalSells = 0;
                const now = new Date();
                const ninetyDaysAgo = new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000);
                
                trades.forEach(trade => {
                    const tradeDate = new Date(trade.transactionDate);
                    if (tradeDate >= ninetyDaysAgo) {
                        const value = Math.abs(trade.securitiesTransacted * trade.price);
                        if (trade.transactionType === 'P-Purchase') totalBuys += value;
                        if (trade.transactionType === 'S-Sale') totalSells += value;
                    }
                });

                // Update summary cards
                document.getElementById(`${symbol.toLowerCase()}-buys-summary`).textContent = '$' + formatNumber(totalBuys);
                document.getElementById(`${symbol.toLowerCase()}-sells-summary`).textContent = '$' + formatNumber(totalSells);

                // Create table
                let html = '<table style="width: 100%; font-size: 0.8rem;">';
                html += '<thead style="background: #f8fafc; border-bottom: 2px solid #e2e8f0;"><tr>';
                html += '<th style="padding: 10px 12px; text-align: left; font-weight: 600; color: #64748b;">Datum</th>';
                html += '<th style="padding: 10px 12px; text-align: left; font-weight: 600; color: #64748b;">Insider</th>';
                html += '<th style="padding: 10px 12px; text-align: center; font-weight: 600; color: #64748b;">Typ</th>';
                html += '<th style="padding: 10px 12px; text-align: right; font-weight: 600; color: #64748b;">Aktien</th>';
                html += '<th style="padding: 10px 12px; text-align: right; font-weight: 600; color: #64748b;">Preis</th>';
                html += '<th style="padding: 10px 12px; text-align: right; font-weight: 600; color: #64748b;">Wert</th>';
                html += '</tr></thead><tbody>';

                trades.forEach((trade, index) => {
                    const isBuy = trade.transactionType === 'P-Purchase';
                    const value = Math.abs(trade.securitiesTransacted * trade.price);
                    const bgColor = index % 2 === 0 ? '#ffffff' : '#f8fafc';
                    
                    html += `<tr style="background: ${bgColor}; border-bottom: 1px solid #f1f5f9;">`;
                    html += `<td style="padding: 10px 12px; color: #64748b;">${formatDate(trade.transactionDate)}</td>`;
                    html += `<td style="padding: 10px 12px; color: #0f172a; font-weight: 500;">${trade.reportingName.substring(0, 25)}${trade.reportingName.length > 25 ? '...' : ''}</td>`;
                    html += `<td style="padding: 10px 12px; text-align: center;">
                        <span style="display: inline-block; padding: 3px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; 
                                     background: ${isBuy ? '#dcfce7' : '#fee2e2'}; color: ${isBuy ? '#166534' : '#991b1b'};">
                            ${isBuy ? 'KAUF' : 'VERKAUF'}
                        </span>
                    </td>`;
                    html += `<td style="padding: 10px 12px; text-align: right; color: #0f172a; font-weight: 500;">${Math.abs(trade.securitiesTransacted).toLocaleString('de-DE')}</td>`;
                    html += `<td style="padding: 10px 12px; text-align: right; color: #64748b;">$${trade.price.toFixed(2)}</td>`;
                    html += `<td style="padding: 10px 12px; text-align: right; color: #0f172a; font-weight: 600;">$${formatNumber(value)}</td>`;
                    html += '</tr>';
                });

                html += '</tbody></table>';
                container.innerHTML = html;
            });

        } catch (error) {
            console.error('Fehler beim Laden von Insider-Trading:', error);
        }
    }

    // Load Institutional Holdings
    async function loadInstitutionalHoldings() {
        try {
            const promises = STOCKS.map(async (symbol) => {
                const url = `${FMP_BASE_URL_V4}/institutional-ownership/symbol-ownership?symbol=${symbol}&limit=15&apikey=${FMP_API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                return { symbol, holdings: data.slice(0, 10) }; // Top 10
            });

            const results = await Promise.all(promises);

            results.forEach(({ symbol, holdings }) => {
                const containerId = `holdings-${symbol.toLowerCase()}`;
                const container = document.getElementById(containerId);
                
                if (!holdings || holdings.length === 0) {
                    container.innerHTML = '<p style="color: #94a3b8; font-size: 0.875rem;">Keine Daten verf√ºgbar.</p>';
                    return;
                }

                // Update holder count
                document.getElementById(`${symbol.toLowerCase()}-holders-count`).textContent = `${holdings.length} Top-Investoren`;

                // Create table
                let html = '<table style="width: 100%; font-size: 0.8rem;">';
                html += '<thead style="border-bottom: 2px solid #e2e8f0;"><tr>';
                html += '<th style="padding: 10px 12px; text-align: left; font-weight: 600; color: #64748b;">#</th>';
                html += '<th style="padding: 10px 12px; text-align: left; font-weight: 600; color: #64748b;">Investor</th>';
                html += '<th style="padding: 10px 12px; text-align: right; font-weight: 600; color: #64748b;">Aktien</th>';
                html += '<th style="padding: 10px 12px; text-align: right; font-weight: 600; color: #64748b;">Wert</th>';
                html += '<th style="padding: 10px 12px; text-align: right; font-weight: 600; color: #64748b;">% Anteil</th>';
                html += '<th style="padding: 10px 12px; text-align: center; font-weight: 600; color: #64748b;">√Ñnderung</th>';
                html += '</tr></thead><tbody>';

                holdings.forEach((holder, index) => {
                    const changeText = holder.change > 0 ? `+${holder.change.toFixed(1)}%` : 
                                      holder.change < 0 ? `${holder.change.toFixed(1)}%` : '0%';
                    const changeColor = holder.change > 0 ? '#16a34a' : holder.change < 0 ? '#dc2626' : '#64748b';
                    const bgColor = index % 2 === 0 ? '#ffffff' : '#f8fafc';
                    
                    html += `<tr style="background: ${bgColor};">`;
                    html += `<td style="padding: 10px 12px; color: #64748b; font-weight: 600;">${index + 1}</td>`;
                    html += `<td style="padding: 10px 12px; color: #0f172a; font-weight: 500;">${holder.investorName}</td>`;
                    html += `<td style="padding: 10px 12px; text-align: right; color: #0f172a;">${formatNumber(holder.shares)}</td>`;
                    html += `<td style="padding: 10px 12px; text-align: right; color: #0f172a; font-weight: 600;">$${formatNumber(holder.totalInvested)}</td>`;
                    html += `<td style="padding: 10px 12px; text-align: right; color: #0f172a; font-weight: 600;">${holder.putCallShare ? holder.putCallShare.toFixed(2) : '0.00'}%</td>`;
                    html += `<td style="padding: 10px 12px; text-align: center;">
                        <span style="color: ${changeColor}; font-weight: 600;">${changeText}</span>
                    </td>`;
                    html += '</tr>';
                });

                html += '</tbody></table>';
                container.innerHTML = html;
            });

        } catch (error) {
            console.error('Fehler beim Laden von Holdings:', error);
        }
    }
    
    // Stock selector function
    function showStock(symbol) {
        // Hide all content
        document.querySelectorAll('.stock-content').forEach(el => el.style.display = 'none');
        
        // Show selected content
        document.getElementById(`stock-content-${symbol.toLowerCase()}`).style.display = 'block';
        
        // Update buttons
        document.querySelectorAll('.stock-selector-btn').forEach(btn => {
            btn.style.background = '#e2e8f0';
            btn.style.color = '#64748b';
        });
        
        const activeBtn = document.getElementById(`btn-${symbol.toLowerCase()}`);
        const colors = { TSLA: '#0ea5e9', RACE: '#dc2626', JNJ: '#16a34a' };
        activeBtn.style.background = colors[symbol];
        activeBtn.style.color = 'white';
    }

    // Page initialization
    window.addEventListener('load', async () => {
        console.log('üìä Investor Relations Dashboard mit FMP API geladen');
        
        // Load all data
        await loadEarningsCalendar();
        await loadInsiderTrading();
        await loadInstitutionalHoldings();
    });
</script>

</body>
</html>
