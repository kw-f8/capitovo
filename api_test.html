<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>capitovo ‚Äî API Test Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Page specific */
        .test-container {
            max-width: 1400px;
            margin: 40px auto;
            padding: 0 20px;
        }
        .feature-box {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .feature-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }
        .stock-card {
            background: #f8fafc;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .stock-info {
            flex: 1;
        }
        .stock-symbol {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1e293b;
        }
        .stock-name {
            font-size: 0.875rem;
            color: #64748b;
        }
        .stock-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0f172a;
        }
        .stock-change {
            font-size: 0.875rem;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .positive {
            color: #16a34a;
            background: #f0fdf4;
        }
        .negative {
            color: #dc2626;
            background: #fef2f2;
        }
        .loading {
            color: #64748b;
            font-style: italic;
        }
        .error {
            color: #dc2626;
            font-size: 0.875rem;
        }
        .sparkline-container {
            width: 200px;
            height: 60px;
        }
        .last-update {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 4px;
        }
        .watchlist-add {
            background: #0ea5e9;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .watchlist-add:hover {
            background: #0284c7;
        }
        .mini-chart {
            margin-top: 16px;
            padding: 16px;
            background: #f1f5f9;
            border-radius: 8px;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">

<header>
    <div class="header-content">
        <div class="logo">
            <a href="index.html">
                <img src="caitavo_logo_wei√ü.png" alt="capitovo Logo" class="header-logo">
            </a>
        </div>
    </div>
</header>

<main class="test-container">
    <div style="margin-bottom: 32px;">
        <h1 style="font-size: 2rem; font-weight: 800; color: #0f172a; margin-bottom: 8px;">üìä Investor Relations Dashboard</h1>
        <p style="color: #64748b;">Insider-Trading, Institutionelle Holdings und Earnings-Kalender f√ºr unsere analysierten Unternehmen.</p>
    </div>

    <!-- Feature 1: Earnings Calendar & Events -->
    <div class="feature-box">
        <h2 class="feature-title">üìÖ Earnings-Kalender & Wichtige Termine</h2>
        <p style="color: #64748b; margin-bottom: 20px; font-size: 0.875rem;">N√§chste Earnings-Termine, Ex-Dividenden-Daten und wichtige Investoren-Events.</p>
        
        <div id="earnings-calendar">
            <!-- Tesla -->
            <div class="stock-card" style="border-left: 4px solid #0ea5e9;">
                <div class="stock-info" style="flex: 2;">
                    <div class="stock-symbol">TSLA</div>
                    <div class="stock-name">Tesla Inc.</div>
                </div>
                <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">N√§chster Earnings</div>
                    <div style="font-size: 1rem; font-weight: 700; color: #0f172a;">23. Januar 2026</div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">Q4 2025 Ergebnisse</div>
                </div>
                <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Ex-Dividenden-Datum</div>
                    <div style="font-size: 1rem; font-weight: 700; color: #94a3b8;">N/A</div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">Keine Dividende</div>
                </div>
            </div>

            <!-- Ferrari -->
            <div class="stock-card" style="border-left: 4px solid #dc2626;">
                <div class="stock-info" style="flex: 2;">
                    <div class="stock-symbol">RACE</div>
                    <div class="stock-name">Ferrari N.V.</div>
                </div>
                <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">N√§chster Earnings</div>
                    <div style="font-size: 1rem; font-weight: 700; color: #0f172a;">5. Februar 2026</div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">FY 2025 Ergebnisse</div>
                </div>
                <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Ex-Dividenden-Datum</div>
                    <div style="font-size: 1rem; font-weight: 700; color: #0f172a;">12. Dezember 2025</div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">‚Ç¨1,45 / Aktie</div>
                </div>
            </div>

            <!-- Johnson & Johnson -->
            <div class="stock-card" style="border-left: 4px solid #16a34a;">
                <div class="stock-info" style="flex: 2;">
                    <div class="stock-symbol">JNJ</div>
                    <div class="stock-name">Johnson & Johnson</div>
                </div>
                <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">N√§chster Earnings</div>
                    <div style="font-size: 1rem; font-weight: 700; color: #0f172a;">21. Januar 2026</div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">Q4 2025 Ergebnisse</div>
                </div>
                <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                    <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Ex-Dividenden-Datum</div>
                    <div style="font-size: 1rem; font-weight: 700; color: #0f172a;">25. Februar 2026</div>
                    <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">$1,30 / Aktie (63. Jahr ‚Üë)</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Feature 2: Insider Trading & Institutional Holdings -->
    <div class="feature-box">
        <h2 class="feature-title">üè¶ Insider-Trading & Institutionelle Holdings</h2>
        <p style="color: #64748b; margin-bottom: 20px; font-size: 0.875rem;">Wer kauft oder verkauft? Aktivit√§ten von Insidern und gro√üen institutionellen Investoren.</p>
        
        <!-- Tesla Insider Activity -->
        <div style="margin-bottom: 32px;">
            <h3 style="font-size: 1.1rem; font-weight: 700; color: #0f172a; margin-bottom: 12px; display: flex; align-items: center;">
                <span style="display: inline-block; width: 8px; height: 8px; background: #0ea5e9; border-radius: 50%; margin-right: 8px;"></span>
                Tesla Inc. (TSLA)
            </h3>
            
            <div id="insider-tsla">
                <p class="loading">Lade Insider-Trading-Daten...</p>
            </div>
            
            <div style="background: #f0f9ff; padding: 16px; border-radius: 8px; border-left: 4px solid #0284c7; margin-top: 16px;">
                <div style="font-size: 0.75rem; font-weight: 600; color: #0c4a6e; text-transform: uppercase; margin-bottom: 8px;">Top Institutionelle Anleger</div>
                <div id="holdings-tsla">
                    <p class="loading">L√§dt...</p>
                </div>
            </div>
        </div>

        <!-- Ferrari Insider Activity -->
        <div style="margin-bottom: 32px;">
            <h3 style="font-size: 1.1rem; font-weight: 700; color: #0f172a; margin-bottom: 12px; display: flex; align-items: center;">
                <span style="display: inline-block; width: 8px; height: 8px; background: #dc2626; border-radius: 50%; margin-right: 8px;"></span>
                Ferrari N.V. (RACE)
            </h3>
            
            <div id="insider-race">
                <p class="loading">Lade Insider-Trading-Daten...</p>
            </div>
            
            <div style="background: #f0f9ff; padding: 16px; border-radius: 8px; border-left: 4px solid #0284c7; margin-top: 16px;">
                <div style="font-size: 0.75rem; font-weight: 600; color: #0c4a6e; text-transform: uppercase; margin-bottom: 8px;">Top Institutionelle Anleger</div>
                <div id="holdings-race">
                    <p class="loading">L√§dt...</p>
                </div>
            </div>
        </div>

        <!-- Johnson & Johnson Insider Activity -->
        <div>
            <h3 style="font-size: 1.1rem; font-weight: 700; color: #0f172a; margin-bottom: 12px; display: flex; align-items: center;">
                <span style="display: inline-block; width: 8px; height: 8px; background: #16a34a; border-radius: 50%; margin-right: 8px;"></span>
                Johnson & Johnson (JNJ)
            </h3>
            
            <div id="insider-jnj">
                <p class="loading">Lade Insider-Trading-Daten...</p>
            </div>
            
            <div style="background: #f0f9ff; padding: 16px; border-radius: 8px; border-left: 4px solid #0284c7; margin-top: 16px;">
                <div style="font-size: 0.75rem; font-weight: 600; color: #0c4a6e; text-transform: uppercase; margin-bottom: 8px;">Top Institutionelle Anleger</div>
                <div id="holdings-jnj">
                    <p class="loading">L√§dt...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Info Box -->
    <div class="feature-box" style="background: #dbeafe; border-left: 4px solid #0284c7;">
        <h2 class="feature-title" style="color: #0c4a6e;">‚ÑπÔ∏è Datenaktualisierung</h2>
        <ul style="color: #1e3a8a; font-size: 0.875rem; line-height: 1.6;">
            <li><strong>Earnings-Termine:</strong> Aktualisierung quartalsweise nach offiziellen Unternehmensmitteilungen</li>
            <li><strong>Dividenden-Daten:</strong> Aktualisierung nach Dividendenank√ºndigungen (quartalsweise)</li>
            <li><strong>Insider-Trading:</strong> Basierend auf SEC Form 4 Filings (w√∂chentliche Updates)</li>
            <li><strong>Institutionelle Holdings:</strong> Basierend auf SEC 13F Filings (quartalsweise)</li>
            <li><strong>Letzte Aktualisierung:</strong> 30. November 2025</li>
        </ul>
    </div>

</main>

<footer class="site-footer border-t py-6 mt-12">
    <div class="footer-inner max-w-6xl mx-auto px-6 text-sm text-gray-500 flex items-center justify-between">
        <div>&copy; 2025 capitovo ‚Äî Test-Dashboard</div>
    </div>
</footer>

<script>
    // Financial Modeling Prep API Configuration
    const FMP_API_KEY = 'OQ6IIDD26Cnm3fPtXiQw8O05ZAaBPFRI';
    const FMP_BASE_URL = 'https://financialmodelingprep.com/api/v3';
    const FMP_BASE_URL_V4 = 'https://financialmodelingprep.com/api/v4';

    const STOCKS = ['TSLA', 'RACE', 'JNJ'];

    // Utility: Format large numbers
    function formatNumber(num) {
        if (num >= 1000000000) return (num / 1000000000).toFixed(1) + 'B';
        if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
        if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
        return num.toFixed(0);
    }

    // Utility: Format date
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('de-DE', { day: '2-digit', month: 'short', year: 'numeric' });
    }

    // Load Earnings Calendar
    async function loadEarningsCalendar() {
        const container = document.getElementById('earnings-calendar');
        container.innerHTML = '<p class="loading">Lade Earnings-Kalender...</p>';

        try {
            const promises = STOCKS.map(async (symbol) => {
                const url = `${FMP_BASE_URL}/historical/earning_calendar/${symbol}?apikey=${FMP_API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                // Get next earnings (future date)
                const now = new Date();
                const nextEarnings = data.find(e => new Date(e.date) > now) || data[0];
                
                return { symbol, earnings: nextEarnings };
            });

            const results = await Promise.all(promises);
            
            let html = '';
            const colors = { TSLA: '#0ea5e9', RACE: '#dc2626', JNJ: '#16a34a' };
            const names = { TSLA: 'Tesla Inc.', RACE: 'Ferrari N.V.', JNJ: 'Johnson & Johnson' };

            results.forEach(({ symbol, earnings }) => {
                const date = earnings ? formatDate(earnings.date) : 'TBA';
                const eps = earnings?.epsEstimated ? `$${earnings.epsEstimated.toFixed(2)} EPS (est.)` : 'N/A';
                
                html += `
                    <div class="stock-card" style="border-left: 4px solid ${colors[symbol]};">
                        <div class="stock-info" style="flex: 2;">
                            <div class="stock-symbol">${symbol}</div>
                            <div class="stock-name">${names[symbol]}</div>
                        </div>
                        <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                            <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">N√§chster Earnings</div>
                            <div style="font-size: 1rem; font-weight: 700; color: #0f172a;">${date}</div>
                            <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">${eps}</div>
                        </div>
                        <div style="flex: 1; padding: 0 16px; border-left: 1px solid #e2e8f0;">
                            <div style="font-size: 0.75rem; color: #64748b; margin-bottom: 4px;">Revenue (est.)</div>
                            <div style="font-size: 1rem; font-weight: 700; color: #0f172a;">${earnings?.revenueEstimated ? '$' + formatNumber(earnings.revenueEstimated) : 'N/A'}</div>
                            <div style="font-size: 0.75rem; color: #64748b; margin-top: 2px;">Analystensch√§tzung</div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        } catch (error) {
            console.error('Fehler beim Laden des Earnings-Kalenders:', error);
            container.innerHTML = '<p style="color: #ef4444;">Fehler beim Laden der Daten. Bitte sp√§ter erneut versuchen.</p>';
        }
    }

    // Load Insider Trading Data
    async function loadInsiderTrading() {
        try {
            const promises = STOCKS.map(async (symbol) => {
                const url = `${FMP_BASE_URL_V4}/insider-trading?symbol=${symbol}&limit=10&apikey=${FMP_API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                return { symbol, trades: data.slice(0, 3) }; // Top 3 trades
            });

            const results = await Promise.all(promises);
            
            const colors = { TSLA: '#0ea5e9', RACE: '#dc2626', JNJ: '#16a34a' };
            const names = { TSLA: 'Tesla Inc.', RACE: 'Ferrari N.V.', JNJ: 'Johnson & Johnson' };

            results.forEach(({ symbol, trades }) => {
                const containerId = `insider-${symbol.toLowerCase()}`;
                const container = document.getElementById(containerId);
                
                if (!trades || trades.length === 0) {
                    container.innerHTML = '<p style="color: #94a3b8; font-size: 0.875rem;">Keine aktuellen Insider-Trades verf√ºgbar.</p>';
                    return;
                }

                // Calculate summary
                let totalBuys = 0, totalSells = 0;
                trades.forEach(trade => {
                    const value = Math.abs(trade.securitiesTransacted * trade.price);
                    if (trade.transactionType === 'P-Purchase') totalBuys += value;
                    if (trade.transactionType === 'S-Sale') totalSells += value;
                });

                // Latest trade
                const latest = trades[0];
                const isBuy = latest.transactionType === 'P-Purchase';
                const tradeValue = Math.abs(latest.securitiesTransacted * latest.price);

                let html = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
                        <div style="background: ${isBuy ? '#f0fdf4' : '#fef2f2'}; padding: 16px; border-radius: 8px; border-left: 4px solid ${isBuy ? '#16a34a' : '#dc2626'};">
                            <div style="font-size: 0.75rem; font-weight: 600; color: ${isBuy ? '#166534' : '#991b1b'}; text-transform: uppercase; margin-bottom: 8px;">
                                Letzter Insider-${isBuy ? 'Kauf' : 'Verkauf'}
                            </div>
                            <div style="font-size: 1.25rem; font-weight: 700; color: #0f172a; margin-bottom: 4px;">
                                $${formatNumber(tradeValue)}
                            </div>
                            <div style="font-size: 0.875rem; color: #64748b;">
                                <strong>${latest.reportingName}</strong><br>
                                ${formatDate(latest.transactionDate)} ¬∑ ${Math.abs(latest.securitiesTransacted).toLocaleString('de-DE')} Aktien @ $${latest.price.toFixed(2)}
                            </div>
                        </div>

                        <div style="background: #f0f9ff; padding: 16px; border-radius: 8px; border-left: 4px solid #0284c7;">
                            <div style="font-size: 0.75rem; font-weight: 600; color: #0c4a6e; text-transform: uppercase; margin-bottom: 8px;">
                                90-Tage-Zusammenfassung
                            </div>
                            <div style="font-size: 0.875rem; color: #0f172a; line-height: 1.8;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
                                    <span>K√§ufe:</span>
                                    <strong style="color: #16a34a;">$${formatNumber(totalBuys)}</strong>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Verk√§ufe:</span>
                                    <strong style="color: #dc2626;">$${formatNumber(totalSells)}</strong>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                container.innerHTML = html;
            });

        } catch (error) {
            console.error('Fehler beim Laden von Insider-Trading:', error);
        }
    }

    // Load Institutional Holdings
    async function loadInstitutionalHoldings() {
        try {
            const promises = STOCKS.map(async (symbol) => {
                const url = `${FMP_BASE_URL_V4}/institutional-ownership/symbol-ownership?symbol=${symbol}&limit=5&apikey=${FMP_API_KEY}`;
                const response = await fetch(url);
                const data = await response.json();
                
                return { symbol, holdings: data.slice(0, 3) }; // Top 3
            });

            const results = await Promise.all(promises);

            results.forEach(({ symbol, holdings }) => {
                const containerId = `holdings-${symbol.toLowerCase()}`;
                const container = document.getElementById(containerId);
                
                if (!holdings || holdings.length === 0) {
                    container.innerHTML = '<p style="color: #94a3b8; font-size: 0.875rem;">Keine Daten verf√ºgbar.</p>';
                    return;
                }

                let html = '<div style="font-size: 0.875rem; color: #0f172a; line-height: 1.6;">';
                holdings.forEach((holder, index) => {
                    const changeText = holder.change > 0 ? `+${holder.change}%` : 
                                      holder.change < 0 ? `${holder.change}%` : 'unver√§ndert';
                    html += `${index + 1}. <strong>${holder.investorName}</strong> ¬∑ ${holder.putCallShare}% (${changeText})<br>`;
                });
                html += '</div>';

                container.innerHTML = html;
            });

        } catch (error) {
            console.error('Fehler beim Laden von Holdings:', error);
        }
    }

    // Page initialization
    window.addEventListener('load', async () => {
        console.log('üìä Investor Relations Dashboard mit FMP API geladen');
        
        // Load all data
        await loadEarningsCalendar();
        await loadInsiderTrading();
        await loadInstitutionalHoldings();
    });
</script>

</body>
</html>
